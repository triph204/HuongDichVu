@model MonAnViewModel
@{
    ViewData["Title"] = "Th√™m M√≥n ƒÇn";
}

<div class="card">
    <div class="card-header">
        <h2>Th√™m M√≥n ƒÇn M·ªõi</h2>
    </div>
    <div class="card-body">
        @if (ViewData.ModelState.ErrorCount > 0)
        {
            <div class="alert alert-danger">
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <p>@error.ErrorMessage</p>
                }
            </div>
        }

        <form method="post" enctype="multipart/form-data">
            <div class="form-row">
                <div class="form-group">
                    <label>T√™n M√≥n *</label>
                    <input type="text" name="TenMon" value="@Model?.TenMon" required>
                </div>

                <div class="form-group">
                    <label>Danh M·ª•c *</label>
                    <select name="DanhMucId" required>
                        <option value="">-- Ch·ªçn danh m·ª•c --</option>
                        @if (Model?.DanhMucList != null)
                        {
                            @foreach (var dm in Model.DanhMucList)
                            {
                                <option value="@dm.DanhMucId" selected="@(Model?.DanhMucId == dm.DanhMucId)">
                                    @dm.TenDanhMuc
                                </option>
                            }
                        }
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Gi√° *</label>
                    <input type="number" name="Gia" value="@Model?.Gia" step="1000" min="0" required>
                </div>

                <div class="form-group checkbox">
                    <label>
                        <input type="checkbox" name="CoSan" value="true" checked="@(Model?.CoSan != false)">
                        C√≥ s·∫µn
                    </label>
                </div>
            </div>

            <!-- ‚úÖ PH·∫¶N UPLOAD ·∫¢NH M·ªöI -->
            <div class="form-group">
                <label>·∫¢nh M√≥n ƒÇn</label>
                
                <!-- Preview Box -->
                <div class="image-preview-container">
                    <img id="imagePreview" 
                         src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='225' viewBox='0 0 300 225'%3E%3Crect width='300' height='225' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='%23999'%3ECh·ªçn ·∫£nh m√≥n ƒÉn%3C/text%3E%3C/svg%3E" 
                         alt="Preview">
                </div>
                
                <!-- Input File -->
                <input type="file" 
                       name="ImageFile" 
                       id="ImageFile"
                       accept="image/jpeg,image/png,image/jpg" 
                       onchange="previewImage(this)">
                
                <small class="text-muted">
                    üì∏ Ch·ªçn ·∫£nh JPG/PNG, t·ªëi ƒëa 2MB. ·∫¢nh s·∫Ω t·ª± ƒë·ªông resize v·ªÅ 800x600px (t·ªâ l·ªá 4:3).
                </small>
            </div>

            <div class="form-group">
                <label>M√¥ T·∫£</label>
                <textarea name="MoTa" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ m√≥n ƒÉn...">@Model?.MoTa</textarea>
            </div>

            <div class="btn-group">
                <button type="submit" class="btn btn-success">
                    üíæ L∆∞u
                </button>
                <a href="/MonAn" class="btn btn-light">
                    ‚Ü©Ô∏è H·ªßy
                </a>
            </div>
        </form>
    </div>
</div>

<!-- ‚úÖ JAVASCRIPT PREVIEW ·∫¢NH -->
<script>
function previewImage(input) {
    const preview = document.getElementById('imagePreview');
    
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Ki·ªÉm tra k√≠ch th∆∞·ªõc file (2MB)
        if (file.size > 2 * 1024 * 1024) {
            alert('‚ö†Ô∏è File ·∫£nh qu√° l·ªõn! Vui l√≤ng ch·ªçn file nh·ªè h∆°n 2MB.');
            input.value = '';
            return;
        }
        
        // Ki·ªÉm tra lo·∫°i file
        if (!file.type.match('image/(jpeg|jpg|png)')) {
            alert('‚ö†Ô∏è Ch·ªâ ch·∫•p nh·∫≠n file JPG, JPEG, PNG!');
            input.value = '';
            return;
        }
        
        // Preview ·∫£nh
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.objectFit = 'cover';
        }
        reader.readAsDataURL(file);
    }
}
</script>